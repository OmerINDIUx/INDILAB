<!DOCTYPE html>
<html lang="es">
  <head>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Islas de Calor en CDMX 2020-2024</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }
      #map {
        height: 100vh;
        width: 100%;
      }
      /* Forzar que el control de capas siempre est√© visible */
      .leaflet-control-layers {
        position: absolute !important;
        top: 10px;
        right: 20px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 6px;
        padding: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        width: 125px;
        height: 280px;
        overflow: visible !important; /* ‚úÖ sin scroll interno */
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      console.group("üó∫Ô∏è Carga del mapa base");

      // === Crear mapa con Positron ===
      const map = L.map("map", {
        zoomControl: true,
        minZoom: 1,
        maxZoom: 28,
      }).setView([19.18, -99.18], 11);

      const positron = L.tileLayer(
        "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",
        {
          attribution:
            '¬© OpenStreetMap, ¬© <a href="https://carto.com/">CARTO</a>',
        }
      ).addTo(map);

      console.log("‚úÖ Mapa creado correctamente.");

      // === Capas de im√°genes ===
      const bounds = [
        [19.0461, -99.5386],
        [19.6003, -98.7906],
      ];
      const raster1 = L.imageOverlay(
        "https://github.com/ErickM02/Rasters/raw/c35870712afc41b9e55c208d343e7790e2e0739a/2020%20UHI.png",
        bounds,
        { opacity: 0.65 }
      );
      const raster2 = L.imageOverlay(
        "https://github.com/ErickM02/Rasters/raw/c35870712afc41b9e55c208d343e7790e2e0739a/2021%20UHI.png",
        bounds,
        { opacity: 0.65 }
      );
      const raster3 = L.imageOverlay(
        "https://github.com/ErickM02/Rasters/raw/c35870712afc41b9e55c208d343e7790e2e0739a/2022%20UHI.png",
        bounds,
        { opacity: 0.65 }
      );
      const raster4 = L.imageOverlay(
        "https://github.com/ErickM02/Rasters/raw/c35870712afc41b9e55c208d343e7790e2e0739a/2023%20UHI.png",
        bounds,
        { opacity: 0.65 }
      );
      const raster5 = L.imageOverlay(
        "https://github.com/ErickM02/Rasters/raw/c35870712afc41b9e55c208d343e7790e2e0739a/2024.1%20UHI.png",
        bounds,
        { opacity: 0.65 }
      );
      const raster6 = L.imageOverlay(
        "https://github.com/ErickM02/Rasters/raw/c35870712afc41b9e55c208d343e7790e2e0739a/2024.2%20UHI.png",
        bounds,
        { opacity: 0.65 }
      );

      const points = [
        { lat: 19.3889, lon: -99.1915, label: "Plaza Exhibimex" },
        { lat: 19.3633, lon: -99.263, label: "Expo Santa F√©" },
        { lat: 19.3558, lon: -99.2147, label: "Campo de Futbol Las √Åguilas" },
        { lat: 19.3298, lon: -99.2107, label: "Plaza San Jer√≥nimo" },
        { lat: 19.3769, lon: -99.2503, label: "Gran Carpa Santa F√©" },
        { lat: 19.3661, lon: -99.2416, label: "Campos Deportivos La Salle" },
        { lat: 19.5025, lon: -99.1938, label: "Industria" },
        { lat: 19.5069, lon: -99.1873, label: "Grupo Bimbo" },
        { lat: 19.4784, lon: -99.165, label: "Correos de M√©xico" },
        { lat: 19.4989, lon: -99.1602, label: "Industria" },
        { lat: 19.5049, lon: -99.1679, label: "Industria" },
        { lat: 19.4883, lon: -99.2102, label: "IES Rosario Castellanos" },
        { lat: 19.3586, lon: -99.1538, label: "Alberca Ol√≠mpica" },
        { lat: 19.4014, lon: -99.1515, label: "Ministerio P√∫blico" },
        { lat: 19.4031, lon: -99.1537, label: "Parque Delta" },
        { lat: 19.389, lon: -99.161, label: "Centro Universitario M√©xico" },
        { lat: 19.3714, lon: -99.1591, label: "Alcald√≠a Benito Ju√°rez" },
        { lat: 19.3708, lon: -99.1649, label: "Cruce Metro Zapata" },
        {
          lat: 19.3801,
          lon: -99.1405,
          label: "Estacionamiento Walmart Nativitas",
        },
        { lat: 19.3447, lon: -99.1423, label: "Taller Metro Tasque√±a" },
        { lat: 19.303, lon: -99.1537, label: "Estacionamiento E. Azteca" },
        { lat: 19.306, lon: -99.1661, label: "Gran Sur" },
        { lat: 19.3102, lon: -99.1195, label: "Cancha/Campo SCT" },
        { lat: 19.309, lon: -99.1279, label: "Campo de Futbol" },
        { lat: 19.3115, lon: -99.1366, label: "Club Am√©rica" },
        { lat: 19.3329, lon: -99.1849, label: "UNAM Campus CU" },
        { lat: 19.3587, lon: -99.2617, label: "Campo" },
        { lat: 19.3826, lon: -99.2538, label: "Galer√≠as Reforma" },
        { lat: 19.4526, lon: -99.125, label: "Talleres gr√°ficos SEGOB" },
        { lat: 19.4431, lon: -99.1518, label: "Deportivo Cuauht√©moc" },
        { lat: 19.4607, lon: -99.1578, label: "Amazon Atlampa" },
        {
          lat: 19.4342,
          lon: -99.1248,
          label: "Mercado Mixcalco/Calle Correo Mayor",
        },
        {
          lat: 19.4155,
          lon: -99.1341,
          label: "Subsecretaria Sistema Penitenciario",
        },
        { lat: 19.4245, lon: -99.1296, label: "Unidad M√©dica Ju√°rez Centro" },
        {
          lat: 19.4258,
          lon: -99.1538,
          label: "Cruce Peatonal Cuauht√©moc-Chapultepec",
        },
        { lat: 19.5278, lon: -99.1677, label: "Industria" },
        { lat: 19.4614, lon: -99.0683, label: "Bosque de Ar√°gon" },
        { lat: 19.4653, lon: -99.0951, label: "Deportivo Fco. Zarco" },
        {
          lat: 19.4863,
          lon: -99.0834,
          label: "Centro Recreativo Bicentenario",
        },
        { lat: 19.4766, lon: -99.0937, label: "Industria" },
        { lat: 19.4825, lon: -99.1037, label: "Industria" },
        { lat: 19.3989, lon: -99.085, label: "Ciudad Deportiva" },
        { lat: 19.4052, lon: -99.0996, label: "Palacio de los Deportes" },
        { lat: 19.398, lon: -99.0739, label: "Campo Deportivo" },
        { lat: 19.4045, lon: -99.0761, label: "Industria" },
        { lat: 19.4059, lon: -99.1086, label: "Industria" },
        {
          lat: 19.3445,
          lon: -99.0866,
          label: "Parque Nacional Cerro de la Estrella",
        },
        { lat: 19.3697, lon: -99.0523, label: "Parque Industrial FINSA" },
        { lat: 19.3672, lon: -99.0462, label: "Parque Cuitl√°huac" },
        { lat: 19.31, lon: -99.0604, label: "Pante√≥n San Lorenzo Tezonco" },
        { lat: 19.3197, lon: -99.055, label: "Industria" },
        { lat: 19.3806, lon: -99.0469, label: "Dpvo. Francisco I. Madero" },
        { lat: 19.3301, lon: -99.2114, label: "Estacionamiento San Jer√≥nimo" },
        { lat: 19.3233, lon: -99.2209, label: "Deportivo" },
        { lat: 19.2906, lon: -99.2447, label: "Subestaci√≥n CFE" },
        { lat: 19.2936, lon: -99.2432, label: "Campo de Futbol" },
        { lat: 19.3199, lon: -99.2392, label: "Campo de Futbol" },
        { lat: 19.4703, lon: -99.2022, label: "Parque Bicentenario" },
        { lat: 19.4551, lon: -99.1646, label: "Estadio IPN" },
        { lat: 19.4373, lon: -99.2236, label: "Hip√≥dromo" },
        { lat: 19.442, lon: -99.2069, label: "COSTCO Polanco" },
        { lat: 19.4634, lon: -99.2023, label: "Refiner√≠a-Pante√≥n Espa√±ol" },
        { lat: 19.212, lon: -98.9777, label: "Campo" },
        { lat: 19.2233, lon: -98.9916, label: "Campo" },
        { lat: 19.2854, lon: -99.0491, label: "Bosque de Tl√°huac - Pista" },
        { lat: 19.2947, lon: -99.0595, label: "Deportivo" },
        { lat: 19.2854, lon: -99.0664, label: "Dep√≥sito vehicular" },
        { lat: 19.2916, lon: -99.1731, label: "Deportivo Vivanco" },
        { lat: 19.2861, lon: -99.1419, label: "Estadio ITESM" },
        { lat: 19.2859, lon: -99.1379, label: "COSTCO Villa Coapa" },
        { lat: 19.4453, lon: -99.1152, label: "Deportivo Eduardo Molina" },
        { lat: 19.4266, lon: -99.1191, label: "Deportivo Venustiano Carranza" },
        { lat: 19.415, lon: -99.1205, label: "Deportivo L√°zaro C√°rdenas" },
        { lat: 19.4263, lon: -99.1247, label: "Mercado La Merced" },
        { lat: 19.4458, lon: -99.0816, label: "Deportivo Ocean√≠a" },
        { lat: 19.3123, lon: -99.0977, label: "Parque Cuemanco" },
        { lat: 19.2729, lon: -99.1187, label: "Industria" },
        { lat: 19.2772, lon: -99.1271, label: "Estacionamiento SAT" },
        { lat: 19.2682, lon: -99.127, label: "Almacenes SEDESOL" },
        { lat: 19.2619, lon: -99.104, label: "Mercado de Xochimilco" },
      ];

      const pointLayer = L.layerGroup(
        points.map((p) => {
          const m = L.marker([p.lat, p.lon]);
          m.bindPopup(`<b>${p.label}</b>`);
          return m;
        })
      );

      // === Custom Controls Implementation ===
      var CustomControl = L.Control.extend({
        options: {
          position: "topright",
        },

        onAdd: function (map) {
          var container = L.DomUtil.create(
            "div",
            "leaflet-bar leaflet-control leaflet-control-custom"
          );

          // Styles for the container
          container.style.backgroundColor = "rgba(255, 255, 255, 0.95)";
          container.style.padding = "10px";
          container.style.borderRadius = "8px";
          container.style.boxShadow = "0 2px 6px rgba(0,0,0,0.2)";
          container.style.width = "150px";
          container.style.fontFamily = "Arial, sans-serif";
          container.style.fontSize = "12px";
          container.style.color = "#333";

          // 1. Checkbox for "Puntos"
          var checkboxDiv = L.DomUtil.create("div", "", container);
          checkboxDiv.style.marginBottom = "10px";
          checkboxDiv.style.display = "flex";
          checkboxDiv.style.alignItems = "center";

          var checkbox = L.DomUtil.create("input", "", checkboxDiv);
          checkbox.type = "checkbox";
          checkbox.id = "toggle-points";
          checkbox.checked = true;
          checkbox.style.marginRight = "8px";
          checkbox.style.cursor = "pointer";

          var labelPoints = L.DomUtil.create("label", "", checkboxDiv);
          labelPoints.htmlFor = "toggle-points";
          labelPoints.innerText = "Puntos de Inter√©s";
          labelPoints.style.cursor = "pointer";
          labelPoints.style.fontWeight = "bold";

          L.DomEvent.on(checkbox, "change", function () {
            if (checkbox.checked) {
              pointLayer.addTo(map);
            } else {
              map.removeLayer(pointLayer);
            }
          });

          // 2. Select Dropdown for Years
          var selectDiv = L.DomUtil.create("div", "", container);

          var labelSelect = L.DomUtil.create("div", "", selectDiv);
          labelSelect.innerText = "Seleccionar periodo:";
          labelSelect.style.marginBottom = "6px";
          labelSelect.style.fontWeight = "bold";

          var select = L.DomUtil.create("select", "", selectDiv);
          select.style.width = "100%";
          select.style.padding = "6px";
          select.style.borderRadius = "4px";
          select.style.border = "1px solid #ccc";
          select.style.background = "#fff";
          select.style.fontFamily = "inherit";

          // Map raster layers to friendly names
          var rasters = [
            { name: "Abril 2020", layer: raster1 },
            { name: "Abril 2021", layer: raster2 },
            { name: "Abril 2022", layer: raster3 },
            { name: "Abril 2023", layer: raster4 },
            { name: "Abril 2024", layer: raster5 },
            { name: "Mayo 2024", layer: raster6 },
          ];

          // Populate options
          rasters.forEach(function (item, index) {
            var option = L.DomUtil.create("option", "", select);
            option.value = index;
            option.innerText = item.name;
          });

          // Prevent click propagation to map
          L.DomEvent.disableClickPropagation(container);
          L.DomEvent.disableScrollPropagation(container);

          // Logic for changing layers
          // Track active raster to remove it before adding new one
          var activeRaster = raster1;

          L.DomEvent.on(select, "change", function () {
            var selectedIndex = parseInt(select.value);
            var newRaster = rasters[selectedIndex].layer;

            // Remove *any* active raster from our list just to be safe,
            // though activeRaster tracking is usually enough.
            rasters.forEach((r) => {
              if (map.hasLayer(r.layer)) {
                map.removeLayer(r.layer);
              }
            });

            newRaster.addTo(map);
            activeRaster = newRaster;
          });

          return container;
        },
      });

      map.addControl(new CustomControl());

      // Initialize defaults
      pointLayer.addTo(map);
      raster1.addTo(map);

      console.log("üå°Ô∏è Custom Control initialized.");
      console.groupEnd();
    </script>
  </body>
</html>
